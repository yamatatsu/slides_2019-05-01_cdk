import { Head, Image } from 'mdx-deck'
import { Container, Row, Col } from 'react-grid-system'
import { CodeSurfer } from 'mdx-deck-code-surfer'
import theme from 'prism-react-renderer/themes/vsDarkPlus'

import { showNumbers } from './consts'
import HeadContents from './components/HeadContents.js'
import Top from './components/Top.js'
import ExLink from './components/ExLink.js'
import packageJson from './package.json'
import ogImage from './assets/images/og.png'
import awsCdkCautionImage from './assets/images/aws-cdk-caution.png'
import fileConstitutionImage from './assets/images/file-constitution.png'
import cdkSynthImage from './assets/images/cdk-synth.png'
import cdkDeployImage from './assets/images/cdk-deploy.png'
import cdkResultImage from './assets/images/cdk-result.png'
import staticSiteDist from './assets/images/staticSiteDist.png'
import naniitteruka from './assets/images/naniitteruka.jpg'

<Head>
  <HeadContents
    title={packageJson.slideTitle}
    urlPath={packageJson.slideKey}
    image={ogImage}
  />
</Head>

<Top
  title={packageJson.slideTitle}
  eventName="Gotanda.js #11"
  hashtag="gotandajs"
/>

---

## 今日話すこと

- AWS CDK とは？
- AWS CDK の書き方
- サンプル

---

## はじめます

---

## AWS CDK とは？

---

### TL;DR

TS を書くと AWS 環境が出来上がる

---

<img src={naniitteruka} style={{}} />

何言ってる分からｎ

---

見てみよう

---

# AWS CDK の書き方

---

### 最小ファイル構成

<img src={fileConstitutionImage} />

---

<CodeSurfer
  title="package.json"
  code={require('!raw-loader!./assets/codes/package.js').default}
  lang="json"
  showNumbers={showNumbers}
  theme={theme}
  steps={[{}, { lines: [11, 13] }, { range: [6, 10] }]}
/>

---

<CodeSurfer
  title="cdk.json"
  code={'{ "app": "ts-node index.ts" }'}
  lang="json"
  showNumbers={showNumbers}
  theme={theme}
/>

---

<CodeSurfer
  title="index.ts"
  code={require('!raw-loader!./assets/codes/minimum.ts').default}
  lang="typescript"
  showNumbers={showNumbers}
  theme={theme}
  steps={[
    {},
    { lines: [1, 4] },
    { lines: [14, 16] },
    { ranges: [[2, 2], [8, 10]] },
  ]}
/>

---

### cdk synth

<img src={cdkSynthImage} />

---

### cdk deploy

<img src={cdkDeployImage} style={{ width: '90vw' }} />

---

### s3 bucket できた

<img src={cdkResultImage} />

---

やったね！

---

TS で書ける CFn(Cloud Formation) て感じ

---

CFn は(あの使いにくい)AWS コンソールをそのままいじっている感じ

---

CDK はより直感的

---

TS の型に導かれる

---

インフラ構成の変更をコードレビューできるよ！

---

### 注意 !!!

<img src={awsCdkCautionImage} style={{ width: '90vw' }} />

---

## サンプル

---

<CodeSurfer
  title="Static Site"
  code={require('!raw-loader!./assets/codes/static-site.ts').default}
  lang="typescript"
  showNumbers={showNumbers}
  theme={theme}
  steps={[
    {},
    { range: [10, 14] },
    { range: [16, 19] },
    { tokens: { 10: [2], 18: [0, 1, 2] } },
    { range: [21, 32] },
    { tokens: { 10: [2], 27: [4, 5, 6] } },
    // { range: [34, 39] },
    {},
  ]}
/>

---

<ExLink href="https://d7srgc5j9isfi.cloudfront.net/">できたページ</ExLink>

---

<ExLink href="https://github.com/yamatatsu/cdk-static-site-sample">
  コードはこちら
</ExLink>

---

<CodeSurfer
  title="Lambda Rest Api"
  code={require('!raw-loader!./assets/codes/lambda-rest-api.ts').default}
  lang="typescript"
  showNumbers={showNumbers}
  theme={theme}
  steps={[
    {},
    { range: [9, 13] },
    { range: [15, 17] },
    { tokens: { 9: [2], 16: [0, 1, 2] } },
    // { range: [19, 24] },
    {},
  ]}
/>

---

<CodeSurfer
  title="hoge.js"
  code={
    require('!raw-loader!./assets/codes/lambda-rest-api-function.ts').default
  }
  lang="javascript"
  showNumbers={showNumbers}
  theme={theme}
/>

---

<ExLink href="https://h8rqfdnrm4.execute-api.ap-northeast-1.amazonaws.com/prod">
  できたAPI
</ExLink>

---

<ExLink href="https://github.com/yamatatsu/cdk-lambda-rest-api-sample">
  コードはこちら
</ExLink>

---

## まとめ

---

# AWS CDK はいいぞ！！

(プロダクトでのご利用は計画的に)

---

# Cloud Formation もいいぞ！！

(プロダクトでガンガン使える)

---

<img
  src="https://i.gyazo.com/87d23d84bc93c83bb165c9d2f239f703.png"
  width="275"
/>

- <ExLink href="https://cureapp.co.jp">CureApp</ExLink>
- アプリで医療機器を作ってる
- AWS, TS, react, RN, Node.js, MongoDB

---

## おわり。

---

## Links

- <ExLink href="https://docs.aws.amazon.com/cdk/api/latest/">Docs</ExLink>
- <ExLink href="https://github.com/awslabs/aws-cdk">Github</ExLink>
- <ExLink href="https://docs.aws.amazon.com/cdk/latest/guide/what-is.html">
    AWS Site
  </ExLink>
- <ExLink href="https://github.com/aws-samples/aws-cdk-examples/tree/master/typescript">
    Examples
  </ExLink>

---

ご清聴ありがとうございました！！
